<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Fitness Tracker - 营养记录</title>
	<link rel="stylesheet" href="css/style.css">
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
	<header class="site-header">
		<h1>营养记录</h1>
		<nav class="site-nav">
			<a href="javascript:void(0)" id="logoutLink">退出登录</a>
		</nav>
	</header>

	<main class="container">
		<section class="grid">
			<div class="card">
				<h2>今日餐食</h2>
				<ul id="meals" class="list"></ul>
				<form id="mealForm" class="form inline-form">
					<input type="text" id="mealName" placeholder="餐食（如：鸡胸肉）" required>
					<input type="number" id="mealCalories" placeholder="卡路里" min="0" required>
					<button type="submit" class="btn">添加</button>
				</form>
			</div>
			<div class="card">
				<h2>合计</h2>
				<p>今日总卡路里：<strong id="totalCalories">0</strong> kcal</p>
			</div>
		</section>
	</main>

	<footer class="site-footer">
		<p>© <span id="year"></span> Fitness Tracker</p>
	</footer>

	<script src="js/auth.js"></script>
	<script src="js/nutrition.js"></script>
	<script>
		document.getElementById('year').textContent = new Date().getFullYear();
		(async function () {
			const user = await window.FTAuth.getUser();
			if (!user) {
				window.location.href = 'index.html';
				return;
			}
		})();
		document.getElementById('logoutLink').addEventListener('click', async function () {
			await window.FTAuth.signOut();
			window.location.href = 'index.html';
		});
		const mealsEl = document.getElementById('meals');
		const totalEl = document.getElementById('totalCalories');

		async function render() {
			const meals = await window.FTNutrition.getToday();
			mealsEl.innerHTML = '';
			let total = 0;
			meals.forEach(m => {
				const li = document.createElement('li');
				li.textContent = `${m.name} — ${m.calories} kcal`;
				mealsEl.appendChild(li);
				total += Number(m.calories || 0);
			});
			totalEl.textContent = total;
		}

		document.getElementById('mealForm').addEventListener('submit', function (e) {
			e.preventDefault();
			const name = document.getElementById('mealName').value.trim();
			const calories = parseInt(document.getElementById('mealCalories').value, 10);
			if (!name || isNaN(calories)) return;
			(async () => {
				await window.FTNutrition.add({ name, calories });
				e.target.reset();
				await render();
			})();
		});

		render();
	</script>
</body>
</html>


